// Module included in the following assemblies:
//
// * machine_management/creating_machinesets/creating-machineset-azure.adoc
// * machine_management/creating_machinesets/creating-machineset-azure-stack-hub.adoc
// * machine_management/control_plane_machine_management/cpmso_provider_configurations/cpmso-config-options-azure.adoc

ifeval::["{context}" == "creating-machineset-azure-stack-hub"]
:ash:
endif::[]

:_mod-docs-content-type: PROCEDURE
include::_attributes/common-attributes.adoc[]
[id="machineset-azure-boot-diagnostics_{context}"]
= Enabling {azure-short} boot diagnostics

[role="_abstract"]
You can enable boot diagnostics on {azure-full} machines that your machine set creates.
By adding `diagnostics.boot` to the `providerSpec`, you gain access to serial logs that you can use to troubleshoot boot issues for the VM.

.Prerequisites

* Have an existing {azure-short}
ifdef::ash[Stack Hub]
cluster.

.Procedure

. Add the `diagnostics` configuration for an {azure-short} Managed storage account to the `providerSpec` field in your machine set YAML file:
+
[source,yaml]
----
providerSpec:
  value:
    diagnostics:
      boot:
        storageAccountType: <azure_managed>
----
+
where:
+
--
`providerSpec.diagnostics.boot.storageAccountType`:: Specifies an {azure-short} Managed storage account.
--
. Add the `diagnostics` configuration for an {azure-short} Unmanaged storage account to the `providerSpec` field in your machine set YAML file:
+
[source,yaml]
----
providerSpec:
  diagnostics:
    boot:
      storageAccountType: CustomerManaged
      customerManaged:
        storageAccountURI: https://<storage-account>.blob.core.windows.net
----
+
where:
+
--
`providerSpec.diagnostics.boot.storageAccountType`:: Specifies an {azure-full} Unmanaged storage account.
`providerSpec.diagnostics.boot.customerManaged.storageAccountURI:`:: Replaces `<storage-account>` with the name of your storage account.
--

[NOTE]
====
Only the {azure-full} Blob Storage data service is supported.
====

.Verification

* On the {azure-full} portal, review the *Boot diagnostics* page for a machine deployed by the machine set, and verify that you can see the serial logs for the machine.

ifeval::["{context}" == "creating-machineset-azure-stack-hub"]
:!ash:
endif::[]